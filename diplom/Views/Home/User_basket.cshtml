<link rel="stylesheet" href="~/css/mainwindow.css" />
<script src="~/js/aboutus.js"></script>
<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.1.1/css/all.min.css">

@using diplom.Models.ViewModels
@model Cart
<body>
<header class="_header" style="background: linear-gradient(to bottom right,#F9D86E,#EDC237);">
    <div class="logo">
        <a href="/Home/MainPage" class="company-name">Dairy Delights Emporium</a>
    </div>
    <div class="mogo">
        <a href="/Home/AboutUsPage"><img src="~/img/Group 84(11).png" style="height:180px;width:180px;margin-top:-5px;" /></a>
    </div>
    <div class="header-buttons">
        <button id="cartButton" class="btn cart-button" style="border: 2px solid black;">
            <i class="fas fa-shopping-basket"></i>
        </button>
        <a href="/Home/User_like" class="btn fav-button" style="border: 2px solid black;">
            <i class="fas fa-heart" style="margin-top: 75%;"></i>
        </a>
        <button class="btn user-button" style="border: 2px solid black;" type="button" id="openAuthModalButton">
            <i class="fas fa-user"></i>
        </button>
    </div>
</header>

    <div id="modaluserr" class="modal" style="overflow-y:hidden;z-index:1">
        <!-- Модальный контент -->
        <div class="modal-content4" style="height:700px; border: 3px solid black;border-radius: 25px;">
            <span class="close" style="margin-top:-5px">&times;</span>
            <center>
                <h5 class="modal-title" style="margin-top:-5px">
                    Личный кабинет
                </h5>
            </center>
            <hr style="color: black;background: black;border: black;height: 1px;">
            <div style="display:flex;width:100%;height:100%;gap:250px">
                <div>
                    <div id="myTabsuser" style="gap:20px;width: 207px;">
                        <div style="display:flex;gap:10px">
                            <i class="fas fa-home"></i>
                            <div data-tab="tab-information">Личная информация</div>
                        </div>
                        <div style="display:flex;gap:10px">
                            <i class="fas fa-lock"></i>
                            <div data-tab="tab-password">Безопасность</div>
                        </div>
                        <div style="display:flex;gap:10px">
                            <i class="fas fa-history"></i>
                            <div data-tab="tab-history">Историяя покупок</div>
                        </div>
                    </div>
                </div>
                <div>
                    <button id="logoutButton" class="fas fa-sign-out-alt"></button>
                    <center style="padding:1%;margin-top:50px">
                        <div class="userimg" style="height: 150px; width: 150px;">

                            <p id="nameuserphoto" style="margin-top:66px">Абоба</p>

                        </div>
                    </center>
                    <div style="width:100%;gap:50px;display:inline-grid;margin-top:40px">
                        @* <form id="userForm"> *@
                        <div style="display:inline-grid;gap:20px">
                            @Html.TextBox("Emailuser", "", new { placeholder = "Email",@class ="userinf" })

                            @Html.TextBox("Nameuser", "", new { placeholder = "Ваше имя",@class ="userinf" })
                            @Html.TextBox("lastNameuser", "", new { placeholder = "Ваша фамилия",@class ="userinf" })

                            <div style="display:flex;gap:10px;margin-left:auto;margin-right:auto" class="userinf">
                                @* <p style="margin-left:-30px">+7</p> *@
                                @* <input type="text" id="phoneRegister" maxlength="10" placeholder="Номер телефона"> *@
                                @Html.TextBox("phoneRegisteruser", "", new { placeholder = "Номер телефона",@class ="numberrr"})
                            </div>
                        </div>
                        @* </form> *@
                        <center>
                            <button id="savebutton" type="button" style="display:flex;justify-content:center;border: 1px solid black;border-radius: 15px;gap:10px;width:100px">
                                <center>
                                    <i class="fas fa-check" style="font-size:20pt;margin-top: 6px;"></i>
                                    <p style="margin-top:4px">Сохранить</p>
                                </center>
                            </button>
                        </center>
                    </div>
                </div>
            </div>
        </div>
    </div>


<div class="main" style="margin-top:6%">
        <div class="container3" id="container3" style="padding-left: 2%;">
    @foreach (var userLike in Model.Users_Baskets)
    {
        <div class="col-sm-4">
                    <div class="product-card" style="z-index:0">
                <div class="card-thumbnail">
                    <img class="img-responsive" src="@userLike.Product.product_img" style="height:300px;width:400px">
                </div>
                <div class="card-content">
                    <div class="send">
                        <img class="basket" src="/img/basket.png" />
                        <i class="fa fa-send fa-2x"></i>
                    </div>
                    @if (@userLike.Product.product_sale > 0)
                    {
                        <!-- Покажите div, только если product_sale больше 0 -->
                        <div class="sale">-@userLike.Product.product_sale%</div>
                    }
                    <h1 class="card-title">
                        @userLike.Product.Name_product
                    </h1>
                    <h2 class="card-sub-title">
                        @userLike.Product.product_article
                    </h2>
                    <p class="description">
                        @userLike.Product.product_description_
                    </p>
                    <div style="display:flex">
                        @if (@userLike.Product.product_sale > 0)
                        {
                            <p class="price">
                                <s>@userLike.Product.product_price руб.</s>
                                @(Math.Round(Convert.ToDecimal(@userLike.Product.product_price - (@userLike.Product.product_price * @userLike.Product.product_sale / 100)))) руб.
                            </p>
                        }
                        else
                        {
                            <p class="price" id="price_@userLike.Product.IdProduct">Цена: @(Math.Round(Convert.ToDecimal(@userLike.Product.product_price))) руб.</p>
                        }
                        <p class="price1">за @userLike.Product.product_weight грамм </p>
                    </div>

                    <ul class="list-inline post-meta">
                        <li class="time-stamp">
                            <i class="fa fa-clock-o"></i> Массовая доля жира: @userLike.Product.product_mass_per_fat%
                        </li>
                        <li class="time-stamp">
                            <i class="fa fa-clock-o"></i> Энергетическая ценность: @userLike.Product.product_fatty кДж.
                        </li>
                    </ul>
                    <button class="info-button1" data-toggle="modal" data-target="#exampleModal" title="Подробнее"
                            data-nametitle="@userLike.Product.Name_product"
                            data-idd="@userLike.Product.IdProduct"
                            data-description="@userLike.Product.product_description_"
                            data-price="@userLike.Product.product_price"
                            data-weight="@userLike.Product.product_weight"
                            data-mass_per_fat="@userLike.Product.product_mass_per_fat"
                            data-fat="@userLike.Product.product_fat"
                            data-protein="@userLike.Product.product_protein"
                            data-fatty="@userLike.Product.product_fatty"
                            data-carb="@userLike.Product.product_carb"
                            data-energy_value="@userLike.Product.product_energy_value"
                            data-storage_life="@userLike.Product.product_storage_life"
                            data-package_id="@userLike.Product.product_package_id"
                            data-storage_conditions="@userLike.Product.product_storage_conditions"
                            data-sale="@userLike.Product.product_sale"
                            data-remain="@userLike.Product.product_remain"
                            data-article="@userLike.Product.product_article"
                            data-sostav="@userLike.Product.product_sostav"
                            data-img="@userLike.Product.product_img"
                            data-provider_id="@userLike.Product.Provider_id"
                            data-package_name="">
                        <i class="fa fa-question"></i>
                    </button>
                            @* <button class="fav-button1" title="Удалить из избранного" data-idd="@userLike.Product.IdProduct">
                            <i class="fas fa-heart-broken"></i>
                    </button> *@
                            <button class="fav-button1" title="В избранное" data-idd="@userLike.Product.IdProduct">
                                <i class="fa fa-heart"></i>
                            </button>
                </div>
            </div>
        </div>
    }
</div>
    <div class="modal fade" id="exampleModal" tabindex="-1" aria-labelledby="exampleModalLabel" aria-hidden="true" style="">
        <div class="modal-dialog">
            <div class="modal-content2">
                <div class="modal-header" style="font-family: 'Dancing Script', cursive;font-weight:bold;font-size:20px">
                    <h5 class="modal-title" id="exampleModalLabel" style="margin-top:-5px">
                        Информация о товаре
                    </h5>
                    <button type="button" class="close" data-dismiss="modal" aria-label="Close" style="background-color: transparent;border: none;margin-top:-55px">
                        <span aria-hidden="true">&times;</span>
                    </button>
                </div>
                <div class="modal-body">
                    <div class="row" style="margin-top:-15px;">
                        <div class="col-sm-3 tovarimg"></div>
                        <div class="col-sm-9 tovarinfo"></div>
                    </div>
                    <hr style="color: black;background: black;border: black;height: 1px;">
                    <form class="formmy">
                        <div class="form-groupimg">
                            <img id="productImage" class="img-responsive" style="width:580px;height:420px;" />
                        </div>
                        <div class="sale1"></div>

                        <div style="display:block;padding-left:20px;grid-column:2;grid-row:1">
                            <div class="ihih">
                                <div class="form-groupdesc">
                                    <center><label id="productNameLabel" for="exampleFormControlInput1"></label></center>
                                </div>

                                <div class="aboba">
                                    <div class="form-groupprice">
                                        <center><label id="productNameLabel" for="exampleFormControlInput1"></label></center>
                                        <p id="description" class="form-control" readonly>
                                            <div style="display:flex;gap:20px;margin-top:-25px">
                                                <P>Цена:</P>
                                                <p id="productPrice" class="form-control" readonly></p>
                                                <p id="productWeight" class="form-control" readonly></p>
                                            </div>
                                        <p id="productSostav" style="margin-top:-10px" class="form-control" readonly></p>
                                        <p id="productArticle" class="form-control" readonly></p>
                                        <div style="display:block;gap:10px">
                                                @* для поставщика и упаковки  *@
                                            <p id="productSupplier"> </p>
                                            <p id="productpa"></p>
                                            <p id="productrate"></p>
                                                @* <div id="rating-stars"></div> *@

                                        </div>
                                    </div>

                                </div>

                                <div class="gf" style="display:flex">
                                    <button id="buttton" class="btn cart-button" style="border: 2px solid black;grid-row:1;grid-column:2;display:flex;align-items: center;width:fit-content">
                                        <i class="fas fa-shopping-basket">В корзину</i>
                                    </button>
                                    <button class="btn fav-button" style="border: 2px solid black;grid-row:1;grid-column:2;margin-left:20px">
                                        <i class="fas fa-heart"></i>
                                    </button>
                                </div>
                            </div>
                        </div>
                        <div id="myTabs">
                            <div class="tab" data-tab="tab-info">Подробная информация</div>
                            <div class="tab" data-tab="tab-reviews">Отзывы</div>
                        </div>
                        <div id="myTabsContent">
                            <div class="tab-content" id="tab-info-content" style="height:260px;margin-top:60px">
                                <div class="gav">
                                    <div style="margin-top:30px">
                                        <div class="form-groupart">
                                            <p id="productMassPerFat" class="form-control" readonly></p>
                                            <p id="productfat" class="form-control" readonly></p>
                                        </div>
                                        <div class="form-groupfat" style="display:flex;gap:5px;margin-top:-20px">
                                            <p>Пищевая ценность: </p>
                                            <p id="productProtein" class="form-control" readonly></p>
                                            <p id="productFatty" class="form-control" readonly></p>
                                            <p id="productCarb" class="form-control" readonly></p>
                                            <p>на 100 гр.</p>
                                        </div>
                                        <div class="form-groupfat" style="margin-top:-20px">
                                            <p id="productEnergyValue" class="form-control" readonly></p>
                                            <p id="productStorageLife" class="form-control" readonly></p>
                                            <p id="productStorageConditions" class="form-control" readonly></p>
                                        </div>
                                    </div>


                                </div>
                            </div>
                            <div class="tab-content pagination" style="display:flex!important;gap:70px;padding-left:40px;" id="tab-reviews-content">
                                <!-- Ваши отзывы и элементы для пагинации здесь -->
                                <div id="ratingcont" style="display:flex;gap:40px">
                                    <div class="ratesss">
                                        <center>
                                            <p id="productrate2" style=" align-self: center;font-size: 25px;margin-top: 30px;"></p>

                                        </center>
                                        <center>
                                            <p style="grid-row:2;margin-top:-1px;font-size: 20px;font-weight:bold;">Общий рейтинг</p>
                                        </center>
                                    </div>
                                    <div class="ratesss2">
                                        <div class="taiting-starsss">
                                            <p style="margin-top: 9px;margin-left:20px">Класс</p>
                                            <p style="color: #FFD700;font-size: 25px;"> &#9733;&#9733;&#9733;&#9733;&#9733;</p>
                                            <div style="display:flex">
                                                <p id="five" style="grid-column:3;margin-top:12px;z-index:1;margin-left:10px">апапав</p>
                                                <div class="progress-container" style="grid-column:3">
                                                    <div class="progress-bar" id="progress-bar"></div>
                                                </div>
                                            </div>
                                        </div>
                                        <div class="taiting-starsss">
                                            <p style="margin-top: 9px;margin-left:20px">Хорошо</p>
                                            <p style="color: #FFD700;font-size: 25px;"> &#9733;&#9733;&#9733;&#9733;</p>
                                            <p style="color: white;font-size: 25px;grid-column:2;margin-top: -65px;margin-left: 84px;">&#9734;</p>
                                            <div style="display:flex">
                                                <p id="four" style="grid-column:3;z-index: 1;margin-top: -53px; margin-left: 10px;">gfdfgdfgfd</p>
                                                <div class="progress-container" style="grid-column:3;margin-top: -55px;margin-left: -20px;">
                                                    <div class="progress-bar" id="progress-bar1"></div>
                                                </div>
                                            </div>
                                        </div>
                                        <div class="taiting-starsss" style="margin-top: -30px;">
                                            <p style="margin-top: 9px;margin-left:20px;">Приемлемо</p>
                                            <p style="color: #FFD700;font-size: 25px;"> &#9733;&#9733;&#9733;</p>
                                            <p style="color: white;font-size: 25px;grid-column:2;margin-top: -65px;margin-left: 63px;">&#9734;&#9734;</p>
                                            <div style="display:flex">
                                                <p id="three" style="grid-column:3;margin-top:-53px;z-index:1;margin-left: 10px;">gfdfgdfgfd</p>
                                                <div class="progress-container" style="grid-column:3;margin-top: -55px;margin-left: -20px;">
                                                    <div class="progress-bar" id="progress-bar2"></div>
                                                </div>
                                            </div>
                                        </div>
                                        <div class="taiting-starsss" style="margin-top: -30px;">
                                            <center><p style="margin-top: 9px;margin-left:20px;">Плохо</p></center>
                                            <p style="color: #FFD700;font-size: 25px;"> &#9733;&#9733;</p>
                                            <p style="color: white;font-size: 25px;grid-column:2;margin-top: -64px;margin-left: 40px;">&#9734;&#9734;&#9734;</p>
                                            <div style="display:flex">
                                                <p id="two" style="grid-column:3;margin-top:-53px;z-index:1;margin-left: 10px;">gfdfgdfgfd</p>
                                                <div class="progress-container" style="grid-column:3;margin-top: -55px;margin-left: -20px;">
                                                    <div class="progress-bar" id="progress-bar3"></div>
                                                </div>
                                            </div>
                                        </div>
                                        <div class="taiting-starsss" style="margin-top: -30px;">
                                            <p style="margin-top: 9px;margin-left:20px">Ужасно</p>
                                            <p style="color: #FFD700;font-size: 25px;"> &#9733</p>
                                            <p style="color: white;font-size: 25px;grid-column:2;margin-top: -65px; margin-left: 20px;">&#9734;&#9734;&#9734;&#9734;</p>
                                            <div style="display:flex">
                                                <p id="one" style="grid-column:3;margin-top:-53px;z-index:1;margin-left: 10px;">gfdfgdfgfd</p>
                                                <div class="progress-container" style="grid-column:3;margin-top: -55px;margin-left: -20px;">
                                                    <div class="progress-bar" id="progress-bar4"></div>
                                                </div>
                                            </div>
                                        </div>

                                    </div>
                                </div>
                                <div id="rewey" style=" margin-top: 250px;margin-left: -1100px;">
                                    <div style="border: 3px solid black;">
                                        <p>dfgdfgdfgdfgdf</p>
                                    </div>
                                </div>
                            </div>

                        </div>
                    </form>


                </div>
            </div>
        </div>
    </div>
    <div class="container4">
        <footer class="footer">
            <div class="footer-left col-md-4 col-sm-6">
                <p class="about">
                    <span> О нашей компании</span> "Dairy Delights Emporium - это гурманский рай для любителей сыра. С особой страстью к мастерству и качеству, мы предлагаем эксклюзивный ассортимент сыров, от классических французских бри и камамберов до редких и экзотических вариаций со всего мира. Наша миссия — дарить неповторимый вкус и наслаждение каждому клиенту, подбирая идеальные сыры для их стола, будь то повседневный ужин или особый праздничный приём. В Cheese Delight вы найдете сыр, который удовлетворит ваш гурманский вкус и превратит каждое блюдо в произведение искусства."
                </p>
                <div class="icons">
                    <a href="#"><i class="fa-brands fa-facebook"></i></a>
                    <a href="#"><i class="fa-brands fa-vk"></i></a>
                    <a href="#"><i class="fa-brands fa-instagram"></i></a>
                </div>
            </div>
            <div class="footer-center col-md-4 col-sm-6">
                <div>
                    <i class="fa fa-map-marker"></i>
                    <p><span> Наш адресс</span> Смоляной переулок,2</p>
                </div>
                <div>
                    <i class="fa fa-phone"></i>
                    <p> +7 9881 761 084</p> |
                    <p> Ежедневно с 8 до 20</p>
                </div>
                <div>
                    <i class="fa fa-envelope"></i>
                    <p><a href="#"> DairyDelightsEmporium@mail.ru</a></p>
                </div>
            </div>
            <div class="footer-right col-md-4 col-sm-6">
                <h2> Dairy Delights <span> Emporium</span></h2>
                <p class="menu">
                    <a href="#"> Каталог</a> |
                    <a href="@Url.Action("AboutUsPage", "Home")" onclick="scrollToElement('mya')"> О нас</a> |
                    <a href="@Url.Action("AboutUsPage", "Home")#contacts"> Контакты</a> |
                    <a href="#myModal1" id="modalOpen"> Политика конфиденциальности</a>
                </p>
                <p class="name"> Dairy Delights Emporium; 2004</p>
            </div>
        </footer>
    </div>
</div>
    <script>
        $(document).ready(function () {
            $('.fav-button1').click(function () {
                // Получаем айди продукта из атрибута data-idd кнопки
                var productId = $(this).data('idd');
                var authenticationSuccess = localStorage.getItem("AuthenticationSuccess");

                if (authenticationSuccess === null || authenticationSuccess === "0") {
                    $('#modal').show();
                    return;
                }
                // Проверяем наличие записи в таблице UserLike
                $.ajax({
                    type: 'POST',
                    url: '/Home/CheckUserLike',
                    data: { productId: productId },
                    dataType: 'json',
                    success: function (data) {
                        // Получаем userId из ответа
                        var userId = data.userId;

                        if (data.exists) {
                            // Запись уже существует, не делаем ничего
                            console.log('Запись уже существует');
                        } else {
                            // Записи нет, добавляем новую запись
                            $.ajax({
                                type: 'POST',
                                url: '/Home/AddUserLike',
                                data: { userId: userId, productId: productId },
                                dataType: 'json',
                                success: function (response) {
                                    console.log('Запись успешно добавлена');
                                },
                                error: function () {
                                    console.log('Произошла ошибка при добавлении записи');
                                }
                            });
                        }
                    },
                    error: function () {
                        console.log('Произошла ошибка при проверке наличия записи');
                    }
                });
            });
        });
    </script>

    <script>
        function checkUserLike(productId, button) {
            $.ajax({
                type: "POST",
                url: "/Home/CheckUserLike",
                data: { productId: productId },
                success: function (response) {
                    if (response.exists) {
                        // Если товар в избранном, добавляем красный фон кнопке
                        button.css('background-color', 'red');
                    } else {
                        // Если товар не в избранном, убираем красный фон кнопки
                        button.css('background-color', 'transparent');                       
                    }
                },
                error: function (xhr, status, error) {
                    // Обработка ошибки, если не удалось выполнить запрос
                    console.error(error);
                }
            });
        }

        // При загрузке страницы выполним проверку наличия товара в избранном для каждой кнопки
        $(document).ready(function () {
            $('.fav-button1').each(function () {
                var button = $(this);
                var productId = button.data('idd');
                checkUserLike(productId, button);
            });
        });
    </script>
</body>
